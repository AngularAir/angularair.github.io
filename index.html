<!DOCTYPE html>
<html>
<head lang="en">
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
  <link rel="shortcut icon" type="image/png" href="favicon.ico"/>
  <title>Angular Air</title>
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.0/css/bootstrap.min.css"/>
  <style>

    /* phone */
    @media only screen and (max-width: 767px) {
      body {
        margin-top: 20px;
        font-size: 16px;
        line-height: 1.6;
      }

      hr {
        margin-top: 20px;
        margin-bottom: 20px;
      }

      .big-gap {
        margin-top: 30px;
      }

      #logo img {
        max-width: 120px;
      }

      #title h1 {
        font-size: 40px;
      }
      #title h2 {
        font-size: 15px;
      }

      #hosts, .guests {
        max-width: 200px;
        margin-bottom: 20px;
      }

      .guests-1 {
        max-width: 180px;
      }

      .host, .guest {
        padding-left: 10px;
        padding-right: 10px;
      }

      .host:first-child, .guest:first-child {
        padding-left: 0;
      }
      .host:last-child, .guest:last-child {
        padding-right: 0;
      }

      .host img, .guest img {
        max-width: 90px;
      }

      .host__name, .guest__name {
        font-size: 10px;
      }
    }

    /* Desktop */
    @media only screen and (min-width: 768px) {
      body {
        padding-left: 20px;
        padding-right: 20px;
        margin-top: 16px;
        font-size: 26px;
        line-height: 2;
      }

      hr {
        margin-top: 70px;
        margin-bottom: 70px;
      }

      .big-gap {
        margin-top: 80px;
      }

      #logo img {
        margin-top: 20px;
        max-width: 300px;
      }

      #title h1 {
        font-size: 80px;
      }
      #title h2 {
        font-size: 30px;
      }

      #hosts, .guests {
        max-width: 400px;
        margin-bottom: 40px;
      }

      .guests-1 {
        max-width: 180px;
      }

      .host, .guest {
        padding-left: 20px;
        padding-right: 20px;
      }

      .host:first-child, .guest:first-child {
        padding-left: 0;
      }
      .host:last-child, .guest:last-child {
        padding-right: 0;
      }

      .host img, .guest img {
        max-width: 180px;
      }

      .host__name, .guest__name {
        font-size: 20px;
      }

    }

    /* shared */
    body {
      color: #303030;
      font-family: 'helvetica neue', Helvetica, Arial;
      font-weight: 300;
      background-color: #fdfdfd;
      max-width: 820px;
      margin-left: auto;
      margin-right: auto;
      width: 90%;
      margin-bottom: 180px;
    }

    a {
      text-decoration: none;
      color: #8c0c12;
    }
    a:hover, a:focus {
      color: #be0409;
      text-decoration: underline;
    }

    h1, h2, h3 {
      font-weight: inherit;
    }

    h3 small {
      color: #7c7c7c;
    }

    hr {
      border: 0;
      border-top: 1px solid #eee;
      height: 0;
      -webkit-box-sizing: content-box;
      -moz-box-sizing: content-box;
      box-sizing: content-box;
    }

    .justify {
      text-align: justify;
    }

    .center {
      text-align: center;
    }

    .clearfix {
      overflow: auto;
    }

    #logo img {
      width: 100%;
    }


    #title h1 {
      margin: 0 20px 20px;
    }
    #title h2 {
      color: #3d3d3d;
    }

    #hosts, .guests {
      position: relative;
      margin-left: auto;
      margin-right: auto;
    }
    .host, .guest {
      float: left;
    }
    .host:first-child, .guest:first-child {
      text-align: right;
    }
    .host:last-child, .guest:last-child {
      text-align: left;
    }
    .host img, .guest img {
      border-radius: 50%;
    }

    #description {
    }

    .host__name, .guest__name {
      display: block;
      text-align: center;
    }

  </style>
</head>
<body ng-app="ngAir" ng-controller="MainCtrl as vm">
<a style="display:none" aria-hidden href="https://plus.google.com/104335210120652090229" rel="publisher">Google+</a>

<div id="content">
  <div id="logo" class="center">
    <img src="logo.png" />
  </div>

  <section id="title" class="center">
    <h1>
      <a href="https://twitter.com/angularair">@AngularAir</a>
    </h1>
    <h2>
      AngularJS video podcast with
      <a href="https://twitter.com/toddmotto">Todd Motto</a> and
      <a href="https://twitter.com/kentcdodds">Kent C. Dodds</a>
    </h2>
  </section>

  <div class="big-gap"></div>

  <section id="hosts" class="clearfix">
    <div class="host">
      <a href="https://twitter.com/toddmotto">
        <img src="todd.png" alt="Todd Motto Profile Picture"/>
        <span class="host__name">Todd Motto</span>
      </a>
    </div>
    <div class="host">
      <a href="https://twitter.com/kentcdodds">
        <img src="kent.png" alt="Kent C. Dodds Profile Picture"/>
        <span class="host__name">Kent C. Dodds</span>
      </a>
    </div>
  </section>

  <section id="description" class="center">
    <p class="justify">
      Angular Air is a video podcast all about
      <a href="https://angularjs.org/">AngularJS</a> hosted by
      <a href="https://developers.google.com/experts/">Google Developer Expert</a>
      Todd Motto and <a href="https://egghead.io/">Egghead.io</a> instructor Kent C. Dodds.
    </p>
  </section>

  <section id="episodes">
    <div ng-repeat="episode in vm.episodes" class="episode">
      <hr/>
      <h3 class="episode__title">
        <a ng-href="{{::episode.hangoutUrl}}">{{::episode.title}}</a>
        <br/>
        <small>{{::episode.displayDate}} {{::episode.time}}</small>
      </h3>
      <div ng-repeat="group in episode.guests" class="guests clearfix guests-{{::group.length}}">
        <div ng-repeat="guest in group" class="guest">
          <a ng-href="https://twitter.com/{{::guest.twitter}}">
            <img ng-src="episodes/{{::episode.date}}/{{::guest.twitter}}.png" alt="{{::guest.name}} Profile Picture"/><span class="guest__name">{{::guest.name}}</span>
          </a>
        </div>
      </div>
      <div class="episode__description justify" ng-bind-html="::episode.description"></div>
    </div>
  </section>

  <section>
    <hr/>
    <p class="justify">
      <h3>Participate</h3>
      Want to be a part of the show? Go to the Angular Air
      <a href="https://trello.com/c/ItaEqtrr">Trello Board</a> to ask and vote for questions that will be addressed
      during the show and join us on <a href="http://webchat.freenode.net/">IRC</a> (#ngair).
    </p>
  </section>

  <section class="center">
    <hr/>
    <p>
      Follow AngularAir on <a href="https://twitter.com/angularair">Twitter</a>
      and <a href="https://plus.google.com/u/0/104335210120652090229/posts">Google+</a>
      <br/>
    </p>
  </section>

  <section id="q-a" ng-controller="ChatCtrl as vm">
    <hr/>
    <h3>Q&A</h3>
    **Note: This is currently in development :-) It's kind of fun to be an alpha tester huh?
    <div ng-if="!vm.user">
      <p><button class="btn btn-primary" ng-click="vm.login()">Log in</button> to ask and vote on questions to be addressed during the show!</p>
    </div>
    <div ng-if="vm.user">
      You're logged in! Hi {{vm.user.displayName}} <button class="btn btn-default" ng-click="vm.logout()">Logout</button>
      <div id="questions">
        <h4>Questions</h4>
        <div ng-repeat="question in vm.questions | sortByVotes">
          <button ng-click="vm.toggleVote(question)" class="btn btn-default btn-sm">+{{question.votes.length || 0}}</button>
          <button ng-click="vm.deleteQuestion(question)" class="btn btn-danger btn-sm" ng-if="vm.user.id === question.user.id">Delete</button>
          <strong>{{question.user.displayName}}</strong> asked:
          <div>{{question.detail}}</div>
        </div>
      </div>
      <div>
        <h4>Submit a question</h4>

        <form ng-submit="vm.submitQuestion()">
          <textarea class="form-control" placeholder="Enter your question here!" ng-model="vm.question.detail"></textarea>
          <button type="submit" class="btn btn-success">Submit</button>
        </form>

      </div>
    </div>

  </section>


</div>
<script src="markdown.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/lodash.js/2.4.1/lodash.min.js"></script>
<script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.3.2/angular.min.js"></script>
<script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.3.2/angular-sanitize.min.js"></script>
<script src="https://cdn.firebase.com/js/client/1.0.21/firebase.js"></script>
<script src="https://cdn.firebase.com/libs/angularfire/0.8.2/angularfire.min.js"></script>
<script src="https://cdn.firebase.com/js/simple-login/1.6.3/firebase-simple-login.js"></script>

<script>
  (function() {
    'use strict';
    var app = angular.module('ngAir', ['firebase']);
    app.constant('markdown', markdown); // global
    app.constant('Firebase', Firebase); // global
    app.constant('_', _); // global

    app.factory('descriptionGetter', function descriptionGetter($http, markdown) {
      'use strict';
      return {
        getDescription: getDescription
      };

      function getDescription(episodeDate) {
        return $http.get('episodes/' + episodeDate + '/description.md').then(function(response) {
          return markdown.toHTML(response.data, 'Maruku');
        });
      }
    });

    app.controller('MainCtrl', function MainCtrl(descriptionGetter, $sce) {
      'use strict';
      var vm = this;
      vm.episodes = [
        {
          title: 'The Angular Team on 1.3 & 2.0',
          displayDate: 'Friday, November 14th, 2014',
          date: '2014-11-14',
          time: '3:00 PM (MST)',
          hangoutUrl: 'https://plus.google.com/u/0/b/104335210120652090229/events/c2182d3bec32vs4jim7r8smc1q4',
          guests: [
            [
              {name: 'Bradly Green', twitter: 'bradlygreen'},
              {name: 'Mi≈°ko Hevery', twitter: 'mhevery'}
            ],
            [
              {name: 'Igor Minar', twitter: 'IgorMinar'},
              {name: 'Pete Bacon Darwin', twitter: 'petebd'}
            ]
          ]
        },
        {
          title: 'Hurdles getting into Angular',
          displayDate: 'Tuesday, December 2nd, 2014',
          date: '2014-12-02',
          time: '12:00 PM (MST)',
          hangoutUrl: 'https://plus.google.com/u/0/events/cg90utbgkqg89fg43k62kav02v4',
          guests: [
            [
              { name: 'John Lindquist', twitter: 'johnlindquist' }
            ]
          ]
        }
      ];

      angular.forEach(vm.episodes, function(episode) {
        descriptionGetter.getDescription(episode.date).then(function(description) {
          episode.description = $sce.trustAsHtml(description);
        });
      });
    });

    app.factory('CurrentUser', function CurrentUser($window) {
      'use strict';
      var key = 'user-obj';
      var store = $window.localStorage;
      var currentUser = null;
      return {
        getUser: getUser,
        setUser: setUser
      };

      function getUser() {
        if (!currentUser) {
          currentUser = JSON.parse(store.getItem(key));
        }
        return currentUser;
      }

      function setUser(user) {
        if (!user) {
          store.removeItem(key);
        } else {
          store.setItem(key, JSON.stringify(user));
        }
      }
    });

    app.controller('ChatCtrl', function ChatCtrl(Firebase, $firebase, $firebaseSimpleLogin, CurrentUser) {
      'use strict';
      var vm = this;
      var authRef = new Firebase('https://bucketstreams.firebaseio.com');
      var authClient = $firebaseSimpleLogin(authRef);
      var questions = new Firebase('htts://bucketstreams.firebaseio.com/ng-air/qa/questions');
      var sync = $firebase(questions);

      vm.user = CurrentUser.getUser();
      vm.questions = sync.$asArray();

      vm.login = login;
      vm.logout = logout;
      vm.deleteQuestion = deleteQuestion;
      vm.submitQuestion = submitQuestion;
      vm.toggleVote = toggleVote;


      function login() {
        authClient.$login('twitter').then(function(user) {
          vm.user = user;
          CurrentUser.setUser(user);
          console.log('user', user);
        }, function (error) {
          console.error('error', error);
          console.error(error.stack);
        });
      }

      function logout() {
        authClient.$logout();
        vm.user = null;
        CurrentUser.setUser();
      }

      function deleteQuestion(question) {
        vm.questions.$remove(question);
      }

      function submitQuestion() {
        vm.question.votes = [];
        vm.question.user = {
          id: vm.user.id,
          displayName: vm.user.displayName
        };
        vm.questions.$add(vm.question).then(function() {
          vm.question = null;
        });
      }

      function toggleVote(question) {
        question.votes = question.votes || [];
        var index = question.votes.indexOf(vm.user.id);
        if (index > -1) {
          question.votes.splice(index, 1);
        } else {
          question.votes.push(vm.user.id);
        }
        vm.questions.$save(question);
      }

    });

    app.filter('sortByVotes', function(_) {
      'use strict';
      return function sortByVotes(questions) {
        return _.sortBy(questions, function(question) {
          return (question.votes || []).length;
        }).reverse();
      }
    });
  })();
</script>
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-56527541-1', 'auto');
  ga('require', 'displayfeatures');
  ga('send', 'pageview');

</script>
</body>
</html>
